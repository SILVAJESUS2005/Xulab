<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//WC3//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:head>
        <title>Contenido del Curso</title>
        <style>
            .course-header {
                padding: 1.5rem;
                background-color: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 8px;
                margin-bottom: 1.5rem;
            }
        </style>
    </h:head>
    <h:body>
        <div class="course-header">

            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">

                <div style="flex: 1;">
                    <h1>#{contenidoController.cursoActual.nombre}</h1>
                </div>

                <h:panelGroup rendered="#{contenidoController.usuarioInscrito}" style="flex: 1; min-width: 250px;">

                    <div style="margin-bottom: 5px; display: flex; justify-content: space-between;">
                        <span style="font-weight: bold; color: #555;">Tu Progreso:</span>
                        <span style="font-weight: bold; color: #1e88e5;">#{contenidoController.obtenerPorcentajeGeneral()}%</span>
                    </div>

                    <p:progressBar value="#{contenidoController.obtenerPorcentajeGeneral()}" 
                                   labelTemplate="{value}%" displayOnly="true" 
                                   style="height: 20px;" />
                </h:panelGroup>

            </div>

            <h:panelGroup id="inscripcionPanel" style="display: block; margin-top: 15px;">
                <h:form rendered="#{sessionManager.isLoggedIn() and !contenidoController.usuarioInscrito}">
                    <p:commandButton value="Inscribirme en este curso" 
                                     action="#{contenidoController.inscribirUsuario()}"
                                     update="inscripcionPanel" 
                                     styleClass="ui-button-success" />
                </h:form>
            </h:panelGroup>

        </div>
        <p:accordionPanel value="#{contenidoController.modulos}" var="modulo" multiple="true">

            <p:tab>
                <f:facet name="title">
                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">

                        <span style="font-weight: bold; font-size: 1.1em;">#{modulo.nombre}</span>

                        <div style="display: flex; align-items: center; gap: 10px;">

                            <span style="font-size: 0.85em; color: #666;">
                                #{contenidoController.obtenerProgresoModulo(modulo)}
                            </span>

                            <h:panelGroup rendered="#{contenidoController.isModuloCompleto(modulo)}">
                                <i class="pi pi-circle-fill" style="color: #2ecc71; font-size: 1.2em;"></i>
                            </h:panelGroup>

                            <h:panelGroup rendered="#{!contenidoController.isModuloCompleto(modulo)}">
                                <i class="pi pi-circle" style="color: #ccc; font-size: 1.2em;"></i>
                            </h:panelGroup>
                        </div>
                    </div>
                </f:facet>

                <ui:repeat value="#{modulo.lecciones}" var="leccion">

                    <h:link outcome="leccion" style="text-decoration: none; color: inherit;">
                        <f:param name="leccionId" value="#{leccion.id}" />

                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; transition: background 0.2s;">

                            <div style="display: flex; align-items: center; gap: 10px;">
                                <h:outputText value="L#{contenidoController.obtenerNumeroVisual(leccion.id)} - #{leccion.nombre}" />
                            </div>

                            <h:panelGroup rendered="#{contenidoController.isLeccionCompletada(leccion.id)}">
                                <i class="pi pi-check" style="color: #2ecc71; font-weight: bold;"></i>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{!contenidoController.isLeccionCompletada(leccion.id)}">
                                <i class="pi pi-chevron-right" style="color: #ccc; font-size: 0.8em;"></i>
                            </h:panelGroup>

                        </div>
                    </h:link>
                </ui:repeat>

            </p:tab>
        </p:accordionPanel>
    </h:body>
</html>